<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>数据库表查询</title>
    <meta name="renderer" content="webkit" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <link rel="stylesheet" href="/js/plugins/layui-v2/layui/css/layui.css" media="all" />
    <style></style>
</head>
<body>
    <div>
        <div style="width: 95%;margin:20px auto">

            <form action="" class="layui-form layui-form-pane">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">查询类型</label>
                        <div class="layui-input-block  ">
                            <select id="Type" lay-filter="NumberType">
                                <option value="0">模糊查询</option>
                                <option value="1">精确查询</option>
                            </select>
                        </div>
                    </div>

                    <div class="layui-inline">
                        <label class="layui-form-label">查询表名</label>
                        <div class="layui-input-block">
                            <input type="text" required lay-verify="required" id="TableName" placeholder="请输入表名" autocomplete="off" class="layui-input">
                        </div>
                    </div>

                    <div class="layui-inline">
                        <div class="layui-input-block">
                            <button class="layui-btn layui-btn-normal" id="btn" type="button">查询</button>
                        </div>
                    </div>
                </div>
                <br>
                <div class="layui-row">
                    <table id="tb" lay-filter="tb"></table>
                </div>

            </form>
        </div>
    </div>
    <script type="text/html" id="idTpl">
        <div>{{d.LAY_TABLE_INDEX+1}}</div>
    </script>
    <script type="text/html" id="ToolBar">
        <a class="layui-btn layui-btn-mini" lay-event="detail">查看详情</a>
        <!-- <a class="layui-btn layui-btn-danger layui-btn-mini" lay-event="del">更新表说明</a> -->
    </script>
    <script type="text/html" id="timeTpl">
        {{d.createtime.replace('T',' ')}}
    </script>
    <script src="/js/plugins/layui-v2/layui/layui.all.js"></script>

    <script type="text/javascript">
        ; !(function () {
            var form = layui.form, table = layui.table, $ = layui.jquery;



            //表格配置
            var tb_options = {
                elem: "#tb",
                id: "tb",
                page: true,
                limit: 50,
                height: 600,
                // size: 'lg',
                even: true,
                data: [],
                cols: [
                    [

                        {
                            fixed: 'left',
                            field: '',
                            title: '序号',
                            width: 60,
                            align: 'center',
                            templet: '#idTpl',
                        },
                        {
                            fixed: 'left',
                            width: 150,
                            align: 'center',
                            toolbar: '#ToolBar'
                        },
                {
                    field: 'TableName',
                    title: '表名',
                    width: 300,
                    align: 'center',
                },
                         {
                             field: 'TableDes',
                             title: '说明',
                             width: 500,
                             align: 'center',
                         }, {
                             field: 'createtime',
                             title: '创建时间',
                             width: 200,
                             align: 'center',
                             templet: '#timeTpl'
                         }


                    ]
                ]
            };
            table.render(tb_options);

            $('#btn').click(function () {
                Search($('#Number').val())
            })



            var Search = function (OrderNumber) {
                if ($("#Type").val() == 1 && $("#TableName").val().trim() == '') {
                    layer.alert('精确查询时表名不能为空！', { icon: 2 });
                    return false;
                }

                $.ajax({
                    type: "Post",
                    url: "/Handler/AdminHandler.ashx",
                    dataType: "Json",
                    data: {
                        "Action": "GetSqlTables",
                        "Type": $("#Type").val(),
                        "TableName": $("#TableName").val().trim()
                    },
                    success: function (data) {
                        if (data.flag != "1") {
                            layer.alert(data.message, { icon: 2 });
                            return false;
                        }

                        tb_options.data = data.table;
                        table.render(tb_options);
                        if (data.table.length > 0) {
                            var w = 0;
                            $.each(data.table, function (i, v) {
                                w += v.weight;
                            });
                            $('#CountWeight').text(w);
                            layer.msg('查询成功！');
                        } else {
                            layer.alert('未查询数据表，请核实后重新查询！', { icon: 2 })
                        }
                    }
                });
            }

          table.on('tool(tb)', function(obj) {
               if (obj.event=='detail') {
                    location.href='SqlTableDetail.html?TableName='+obj.data.TableName;
               }
            })

            //JQ ajax全局事件
            $(document).ajaxStart(function () {
                layer.load();
            }).ajaxComplete(function (request, status) {
                layer.closeAll('loading')
                //  layer.closeAll('loading');
            }).ajaxError(function () {
                layer.alert('程序出现错误,请重试或联系管理员!', {
                    icon: 2
                })
                return false;
            });

        })();



    </script>
</body>
</html>