<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" id="viewport" content="width=device-width, initial-scale=1">
    <title>未入库采购申请单</title>
    <!-- 引入样式 -->
    <link href="../js/mintui/2.2.13/style.css" rel="stylesheet" />
    <link href="../js/vue/loading.css" rel="stylesheet" />
    <!--<link rel="stylesheet" href="https://unpkg.com/mint-ui/lib/style.css">-->
    <style>
    body {
        background-color: #eee;
    }

    .wrapper {
        overflow: scroll;
        margin-top: 56px;
    }

    .mint-navbar {
        margin-top: 40px;
    }

    .mint-tab-container {
        margin-top: 100px;
    }

    .left {
        margin-left: 8px;
        font-size: 12px;
    }

    .right {
        float: right;
        margin-right: 6px;
        font-size: 12px;
    }

    .title {
        font-size: 14px;
        color: #c62828;
        font-weight: bold;
        height: 38px;
        line-height: 38px;
        margin-left: 6px;
    }

    .content {
        border-top: 1px solid #ddd;
        height: 32px;
        line-height: 32px;
        font-size: 13px;
    }

    .mt-tab-container-div {
        margin-bottom: 15px;
        background-color: #fff;
        border-radius: 5px;
    }

    .nodata {
        text-align: center;
        font-size: 40px;
        color: rgba(0, 0, 0, 0.3);
        margin-top: 50px;
    }

    .nomore {
        text-align: center;
        color: #888;
        font-weight: bold;
    }

    ul li {
        list-style-type: none;
    }
 

/*.box{
position:fixed;
right:10px;
bottom: 10px;
height:30px;
width: 50px; 
text-align:center;
padding-top:20px; 
background-color: lightblue;
border-radius: 20%;
overflow: hidden;
}
.box:hover:before{
top:50%
}
.box:hover .box-in{
visibility: hidden;
}
.box:before{
position: absolute;
top: -50%;
left: 50%;
transform: translate(-50%,-50%);
content:'回到顶部';
width: 40px;
color:peru;
font-weight:bold;
} 
.box-in{
visibility: visible;
display:inline-block;
height:20px;
width: 20px;
border: 3px solid black;
border-color: white transparent transparent white;
transform:rotate(45deg);
}*/
    </style>
</head>

<body>
    <div id="vm">
        <mt-header title="未入库采购申请单" fixed >
         <span   slot="right"    >  {{label}}  <mt-badge  v-if="datas.length!=0"  slot="right" size="small" type="error" v-text="datas.length"></mt-badge></span> 
             
        </mt-header>

        <div class="wrapper" :style="{height:h+'px'}">
            <div class="nodata" v-if="datas.length==0" v-text="'暂无未入库请购单'"> </div>
            <mt-loadmore :bottom-method="loadBottom" :bottom-all-loaded="allLoaded" :auto-fill="false" ref="loadmore" bottom-pull-text="" bottom-drop-text="释放加载更多">
                <div class="mt-tab-container-div" v-for="(item,index) in lists">
                    <div class="title"><span v-text="(index+1)+'.存货名称：'+item.cInvName"></span> </div>
                    <div class="content"><span class="left" v-text="'存货编码：'+item.cInvCode"> </span><span class="right" v-text="'规格型号：'+item.cInvStd"> </span></div>
                    <div class="content"><span class="left" v-text="'请购单编号：'+item.cCode"> </span><span class="right"  v-text="'请购单日期：'+item.dDate.split(' ')[0]"> </span></div>
                    <div class="content"><span class="left" v-text="'请购数量：'+item['请购单数量']" > </span><span class="right" v-text="'订单数量：'+item['采购订单数量']"> </span></div>
                    <div class="content"><span class="left" v-text="'到货数量：'+item['采购到货单数量']"> </span><span class="right" v-text="'入库数量：'+item['采购入库单数量']"> </span></div>
                    <div class="content"><span class="left" v-text="'请购部门：'+item.cDepName"> </span><span class="right" v-text="'申请人：'+item.cMaker"> </span></div>
                </div>
            </mt-loadmore>
            <div class="nomore" v-show="lists.length!=0&&datas.length==lists.length" v-text="'没有更多了'"> </div>
        </div>

       

<!-- <div id="box" class="box">
<div class="box-in"></div> -->
</div> 
    </div>
    <script src="../js/vue/axios.js"></script>
    <script src="../js/vue/axios_FUN.js"></script>
    <script src="../js/vue/vue-2.5.13.min.js"></script>
    <script src="../js/mintui/2.2.13/index.js"></script>
    <script>
    var vm = new Vue({
        el: "#vm",
        data: {
            lists: [],
            allLoaded: false,
            datas: [],
            label:"",
            distance: 30, // 每次加载的数据条数
        },
        methods: {


            loadBottom: function() {
                this.$refs.loadmore.onBottomLoaded();
                this.getList();
            },
            getList: function() {
                if (this.datas.length == 0) {
                    return false;
                }

                var i = 0,
                    len = this.lists.length;

                if (len >= this.datas.length) {
                    this.allLoaded = true;
                    return;
                }
                let a = this.datas.length - this.lists.length;
                if (a < this.distance) {
                    this.allLoaded = true;
                    for (i; i < a; i++) {
                        this.lists.push(this.datas[len + i]);
                    }
                } else {
                    for (i; i < this.distance; i++) {
                        this.lists.push(this.datas[len + i]);
                    }
                }

            },
            getDate(date) {
                this.datas = [];
                this.lists = [];
               let _this=this;
                axios({
                    url: "/handler/mobilehandler.ashx",
                    method: "post",
                    data: {
                        "Action": "DLproc_PUAppWarnBySel",
                        "date": date
                    }
                }).then((res) => {
                    if (res) {
                        console.log(res.message);
                        _this.label=res.message;
                        if (res.data.length == 0) {
                            return false;
                        }
                        //李高波－－注塑
                        if (res.message == '13550158258') {
                            // this.label = "注塑车间"
                            _this.datas = res.data.filter((o) => {
                                if (o.cDepCode == '0503') {
                                    return true;
                                }
                                return false;
                            })
                        }
                        //邹建军（挤塑+模具）
                        else if (res.message == '13880625703') {
                            // this.label = "挤塑车间"
                            _this.datas = res.data.filter((o) => {
                                if (o.cDepCode == '0502' || o.cDepCode == '0504') {
                                    return true;
                                }
                                return false;
                            })
                        }
                        //兰涛－－模具车间 
                        else if (res.message == '13688324849') {
                            // this.label = "模具车间"
                            _this.datas = res.data.filter((o) => {
                                if (o.cDepCode == '0504') {
                                    return true;
                                }
                                return false;
                            })
                        }
                        //吴世明，全部
                                else if (res.message == '13980413990'||res.message == '15308078836') {
                            // this.label = "所有单据"
                            _this.datas = res.data;
                        } 
                        //其余人员，按手机号过滤，只能看到自己提交的单子
                        else {
                            // this.label = res.message;
                             _this.datas = res.data.filter((o) => {
                                if (o.cPersonPhone == res.message) {
                                    return true;
                                }
                                return false;
                            })
                        }
                        _this.getList();

                    }

                })
            }

        },
        mounted: function() {

        },
        created() {
            this.h = document.documentElement.clientHeight - 46;
            this.pickerValue = new Date();
            this.getDate(GetQueryString('date'));
        }
    })

    function FormatDate(date, fmt) {
        var o = {
            "M+": date.getMonth() + 1, //月份
            "d+": date.getDate(), //日
            "h+": date.getHours(), //小时
            "m+": date.getMinutes(), //分
            "s+": date.getSeconds(), //秒
            "q+": Math.floor((date.getMonth() + 3) / 3), //季度
            "S": date.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (date.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    }

    function GetQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }
    </script>
</body>

</html>