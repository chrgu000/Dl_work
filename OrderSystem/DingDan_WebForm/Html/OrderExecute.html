<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>多联网上订单系统</title>
    <meta name="renderer" content="webkit" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <link rel="stylesheet" href="../js/plugins/layui-1.0.9/css/layui.css" media="all" />
    <link href="../js/plugins/bootstrapTable/bootstrap.min.css" rel="stylesheet" />
    <link href="../js/plugins/bootstrapTable/bootstrap-table.min.css" rel="stylesheet" />
    <script src="../js/jquery-1.11.0.min.js"></script>
    <script src="../js/plugins/bootstrapTable/bootstrap.min.js"></script>
    <script src="../js/plugins/bootstrapTable/bootstrap-table.min.js"></script>
    <script src="../js/plugins/bootstrapTable/bootstrap-table-export.js"></script>
    <script src="../js/plugins/bootstrapTable/bootstrap-table-zh-CN.min.js"></script>
    <script src="../js/plugins/bootstrapTable/tableExport.js"></script>

    <style>
        .bl {
            vertical-align: middle;
            line-height: 36px;
        }

        td, th {
            font-size: 12px;
        }


        .selected {
            background-color: red;
        }

        .bl {
            vertical-align: middle;
            line-height: 36px;
        }


        .red {
            background: #FF6666;
        }

        .green {
            background-color: #99CC66;
        }

        .pink {
            background-color: #FFCCCC;
        }

        .orange {
            background-color: #FFFF99;
        }

        .blue {
            background-color: #99CCFF;
        }

        .brown {
            background-color: #CC6600;
        }

        .pansy {
            background-color: #666699;
        }

        .layui-form-label {
            width: auto;
        }

        .lab {
            width: 100px;
            color: black;
        }

            .lab:hover {
                color: black;
            }

        .grey {
            color: black;
            background-color: #c9c8c8;
        }

        .layui-btn + .layui-btn {
            margin-left: 0;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="panel-body" style="padding-bottom:0px;">
            <div class="panel panel-default">
                <div class="panel-heading">查询条件</div>
                <div class="panel-body">
                    <form id="formSearch" class="form-horizontal layui-form">
                        <div class="form-group" style="margin-top:5px">
                            <label class="control-label col-sm-1" for="txt_search_departmentname">查询类别</label>
                            <div class="col-sm-2">
                                <select class="layui-select" id="timetype">
                                    <option value="0">下单时间</option>
                                    <option value="1">审核时间</option>
                                </select>
                            </div>
                            <label class="control-label col-sm-1" for="txt_search_departmentname">时间范围</label>
                            <div class="col-sm-3">
                                <div class="col-sm-6">
                                    <input class="layui-input" placeholder="开始日期" id="start_date">
                                </div>
                                <div class="col-sm-6">
                                    <input class="layui-input" placeholder="截止日期" id="end_date">
                                </div>
                            </div>
                            <label class="control-label col-sm-1" for="txt_search_departmentname">DL网单号</label>
                            <div class="col-sm-1" style="text-align:left;">
                                <input type="text" class="layui-input" placeholder="输入网单号" id="strbillno">
                                <!--  <button type="button" style="margin-left:50px" id="btn" class="btn btn-primary">查询</button>-->
                            </div>
                            <label class="control-label col-sm-1" for="txt_search_departmentname">开票单位</label>
                            <div class="col-sm-2" style="text-align:left;">
                                <select class="layui-select" id="kpdw">
                                    <option value="0">全部</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top:5px">
                            <label class="control-label col-sm-1" for="txt_search_departmentname">下单账户</label>
                            <div class="col-sm-2" style="text-align:left;">
                                <select class="layui-select" id="Acount">
                                    <option value="0">全部</option>
                                </select>
                            </div>
                            <label class="control-label col-sm-1" for="txt_search_departmentname">明细选择</label>
                            <div class="col-sm-3">
                                <div class="col-sm-4"><input type="checkbox" name="" id="showtype" title="显示明细订单" checked="checked"></div>
                                <div class="col-sm-4 col-sm-offset-2"><input type="checkbox" name="" id="fhtype" title="包含未发货订单" checked="checked"></div>
                            </div>
                            <div class="col-sm-1"><button type="button" style="margin-left:50px" id="btn" class="btn btn-primary">查询</button></div>
                            <!-- <label class="control-label col-sm-1" for="txt_search_departmentname">查询结果过滤</label>-->
                            <div class="col-sm-4">
                                <div class="col-sm-4">
                                    <input type="button" class="layui-btn layui-btn-mini lab green" color="green" value="单笔订单合计 " />
                                    <input type="button" class="layui-btn layui-btn-mini lab pansy" color="pansy" value="未发货 " />
                                </div>
                                <div class="col-sm-4">
                                    <input type="button" class="layui-btn layui-btn-mini lab blue" color="blue" value="未发完,无退货 " />
                                    <input type="button" class="layui-btn layui-btn-mini lab brown" color="brown" value="未发完,有退货 " />
                                </div>
                                <div class="col-sm-4">
                                    <input type="button" class="layui-btn layui-btn-mini lab orange" color="orange" value="已发完,有退货 " />
                                    <input type="button" class="layui-btn layui-btn-mini lab red" color="red" value="无提货清单退货 " />
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div id="toolbar" class="btn-group">
                <!--<select id="sel_exportoption" class="form-control">
                    <option value="all">Export All</option>
                    <option value="">Export Basic</option>
                    <option value="selected">Export Selected</option>
                </select>-->
            </div>
            <table id="tb" data-reorderable-columns="true"></table>
        </div>
    </div>
    <script type="text/javascript" src="../js/plugins/layui-1.0.9/layui.js"></script>
    <!-- <script type="text/javascript" src="../js/Project/function.js?v=1"></script> -->

    <script type="text/javascript">
    var a=Date.parse(new Date());
    document.write(' <script type="text/javascript"  charset="utf-8" src="\/js\/Project\/function.js?v='+a+'"><\/script>')
</script>
    <script>

        layui.use(['util', 'laydate', 'form'], function () {
            var form = layui.form(),
                layer = layui.layer,
              laydate = layui.laydate;
            //  element = layui.element(); //Tab的切换功能，切换事件监听等，需要依赖element模块

            var start = {
                min: '2016-01-01 00:00:00'
                 , max: '2099-06-16 23:59:59'
               , format: 'YYYY-MM-DD hh:mm:ss' //日期格式
                , istime: true     //是否开启时间选择
                 , istoday: false
                 , choose: function (datas) {
                     end.min = datas; //开始日选好后，重置结束日的最小日期
                     end.start = datas //将结束日的初始值设定为开始日
                 }
            };

            var end = {
                min: laydate.now()
              , max: '2099-06-16 23:59:59'
                 , format: 'YYYY-MM-DD hh:mm:ss' //日期格式
                , istime: true     //是否开启时间选择
              , istoday: false
              , choose: function (datas) {
                  start.max = datas; //结束日选好后，重置开始日的最大日期
              }
            };

            $("#start_date").click(function () {
                start.elem = this;
                laydate(start);
            });

            $("#end_date").click(function () {
                end.elem = this;
                laydate(end);
            });


            $.ajax({
                url: "../Handler/ProductHandler.ashx",
                type: "Post",
                dataType: "Json",
                data: { "Action": "Get_KPDW" },
                success: function (data) {

                    var html = "";
                    $.each(data.dt, function (i, v) {
                        html += '<option value=' + v.cCusCode + '>' + v.cCusName + '</option>'
                    })
                    $("#kpdw").append(html);
                    html = "";
                    $.each(data.datatable, function (i, v) {
                        html += '<option value=' + v.cCusCode + '>' + v.cCusCode + '</option>'
                    });
                    $("#Acount").append(html);
                    form.render();
                    //     draw_tb(data.dt);
                }
            })

        })

        $("#btn").click(function () {

            $.ajax({
                url: "../Handler/ProductHandler.ashx",
                type: "Post",
                dataType: "Json",
                data: {
                    "Action": "DLproc_OrderExecuteBySel",
                    "timetype": $("#timetype").val(),
                    "strbillno": $("#strbillno").val(),
                    "start_date": $("#start_date").val(),
                    "end_date": $("#end_date").val(),
                    "kpdw": $("#kpdw  option:selected").val(),
                    "showtype": $("#showtype").prop("checked") == false ? "0" : "1",
                    "fhtype": $("#fhtype").prop("checked") == false ? "0" : "1",
                    "Acount": $("#Acount option:selected").val()
                },
                success: function (data) {
                    if (data.flag != "1") {
                        layer.alert(data.message, { icon: 2 });
                        return false;
                    }
                    $("#tb").bootstrapTable("load", data.dt);


                }
            })
        })
    </script>

    <script>

        $(function () {

            //1.初始化Table
            var oTable = new TableInit();
            //  var oButton = new ButtonInit();
            oTable.Init();
        });


        var TableInit = function () {
            var oTableInit = new Object();
            var d = []
            //初始化Table
            oTableInit.Init = function () {
                $('#tb').bootstrapTable({
                    data: d,         //请求后台的URL（*）
                    //  method: 'get',                      //请求方式（*）
                    toolbar: '#toolbar',                //工具按钮用哪个容器
                    striped: true,                      //是否显示行间隔色
                    cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                    pagination: true,                   //是否显示分页（*）
                    sortable: false,                     //是否启用排序
                    sortOrder: "asc",                   //排序方式
                    queryParams: oTableInit.queryParams,//传递参数（*）
                    sidePagination: "client",           //分页方式：client客户端分页，server服务端分页（*）
                    pageNumber: 1,                       //初始化加载第一页，默认第一页
                    pageSize: 50,                       //每页的记录行数（*）
                    pageList: [50, 100, 200, 'All'],        //可供选择的每页的行数（*）
                    clickToSelect: true,
                    showExport: true,                     //是否显示导出
                    exportDataType: "all",              //basic', 'all', 'selected'.
                    exportTypes: ["excel"],
                    showColumns: true,                  //是否显示所有的列
                    minimumCountColumns: 2,             //最少允许的列数
                    undefinedText: "",                   //当数据为 undefined 时显示的字符
                    clickToSelect: true,                 //点击选中行
                    // showRefresh:true,                    //显示刷新按钮
                    //cardView:true,
                    // showToggle: true,                          //切换卡模式
                    // detailView: true,                       //详细页面模式
                    height: 500,
                    search: true,
                    rowStyle: function rowStyle(row, index) {
                        if (row.cinvname == "合计") {
                            return {
                                css: { "background-color": "#99CC66" }
                            };
                        }
                        else {
                            var color = "";
                            switch (row.BillStatus) {
                                case "未发货":
                                    return { css: { "background-color": "#666699" } };
                                    break;
                                case "未发完,无退货":
                                    return { css: { "background-color": "#99CCFF" } };
                                    break;
                                case "未发完,有退货":
                                    return { css: { "background-color": "#CC6600" } };
                                    break;
                                case "已发完,有退货":
                                    return { css: { "background-color": "#FFFF99" } };
                                    break;
                                case "无提货清单退货":
                                    return { css: { "background-color": "#FF6666" } };
                                    break;
                            }
                        }
                        return { css: { "background-color": "#ffffff" } }
                    },
                    columns: [
                    // {
                    //     checkbox: true
                    // },
                    {
                        field: 'strBillNo',
                        title: 'DL网单号'
                    }, {
                        field: 'cSOCode',
                        title: '正式订单号'

                    }, {
                        field: 'datBillTime',
                        title: '下单时间',
                        formatter: function (value, row, index) {
                            if (value != null && value != "") {
                                return return_datetime(value);
                            }
                            else return "";
                        }
                    }, {
                        field: 'datAuditordTime',
                        title: '审核时间',
                        formatter: function (value, row, index) {
                            if (value != null && value != "") {
                                return return_datetime(value);
                            }
                            else return "";
                        }
                    },
                      {
                          field: 'ccusname',
                          title: '开票单位'
                      },
                      {
                          field: 'cinvname',
                          title: '商品名称'
                      },
                      {
                          field: 'cInvStd',
                          title: '商品规格'
                      },
                      {
                          field: 'iquantity',
                          title: '订单数量'
                      },
                      {
                          field: 'isum',
                          title: '订单金额'
                      },
                      {
                          field: 'U8iFHQuantity',
                          title: '发货数量'
                      },
                      {
                          field: 'U8iFHMoney',
                          title: '发货金额'
                      },
                      {
                          field: 'U8iTHQuantity',
                          title: '退货数量',
                      },
                      {
                          field: 'U8iTHMoney',
                          title: '退货金额'
                      },
                      {
                          field: 'BillStatus',
                          title: '状态'
                      },
                      {
                          field: 'cdefine11',
                          title: '地址信息',
                          visible: false,
                          width: 100
                      },
                     {
                         field: 'strRemarks',
                         title: '备注',
                         visible: false,
                         width: 100
                     },
                     {
                         field: 'strAllAcount',
                         title: '下单账号'
                     }]
                });
            };

            //得到查询的参数
            oTableInit.queryParams = function (params) {
                var temp = {   //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
                    limit: params.limit,   //页面大小
                    offset: params.offset,  //页码
                    departmentname: $("#txt_search_departmentname").val(),
                    statu: $("#txt_search_statu").val()
                };
                return temp;
            };

            oTableInit.response = function (res) {
                return res.rows;

            }
            return oTableInit;
        };

    </script>

</body>
</html>