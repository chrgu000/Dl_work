<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>多联网上订单系统</title>
    <meta name="renderer" content="webkit" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <link rel="stylesheet" href="../js/plugins/layui-1.0.9/css/layui.css" media="all" />
    <link href="../js/plugins/dataTables/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/js/plugins/table/css/bootstrap4alpha.css" />
    <link rel="stylesheet" type="text/css" href="/js/plugins/table/css/dataTables.bootstrap4.css">
    <link rel="stylesheet" type="text/css" href="/js/plugins/table/css/buttons.bootstrap4.css">
    <style>
        .layui-table th, .layui-table td {
            text-align: center;
            font-size: 12px;
        }

        .btns {
            border-bottom: 1px solid #7bd1e0;
            height: 50px;
            line-height: 50px;
        }

        .bl {
            vertical-align: middle;
            line-height: 36px;
        }

        form {
            min-height: 500px;
        }

        .selected {
            background-color: red;
        }

        .bl {
            vertical-align: middle;
            line-height: 36px;
        }

        .red {
            background: #FF6666;
        }

        .green {
            background-color: #99CC66;
        }

        .pink {
            background-color: #FFCCCC;
        }

        .orange {
            background-color: #FFFF99;
        }

        .blue {
            background-color: #99CCFF;
        }

        .brown {
            background-color: #CC6600;
        }

        .pansy {
            background-color: #666699;
        }

        .layui-form-label {
            width: auto;
        }

        .lab {
            width: 100px;
            color: black;
        }

            .lab:hover {
                color: black;
            }

        .grey {
            color: black;
            background-color: #c9c8c8;
        }
    </style>
</head>
<body>
    <div style="margin: 0px;" class="iframe">
        <div class="layui-tab">

            <div class="layui-tab-content">
                <div class="layui-tab-item layui-show">
                    <form action="" class="layui-form">
                        <div class="btns" style="height: auto">
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label class="layui-form-label">查询类别</label>
                                    <div class="layui-input-inline" style="width: 120px;">
                                        <select class="layui-select" id="timetype">
                                            <option value="0">下单时间</option>
                                            <option value="1">审核时间</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">时间范围</label>
                                    <div class="layui-input-inline">
                                        <input class="layui-input" placeholder="开始日期" id="start_date" onclick="layui.laydate({ elem: this, istime: true, format: 'YYYY-MM-DD hh:mm:ss' })">
                                    </div>
                                    <div class="layui-input-inline">
                                        <input class="layui-input" placeholder="截止日期" id="end_date" onclick="layui.laydate({ elem: this, istime: true, format: 'YYYY-MM-DD hh:mm:ss' })">
                                    </div>
                                </div>

                                <div class="layui-inline">
                                    <label class="layui-form-label">DL网单号</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input" placeholder="输入网单号" id="strbillno">
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">开票单位</label>
                                    <div class="layui-input-inline" style="width: 200px;">
                                        <select class="layui-select" id="kpdw">
                                            <option value="0">全部</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">选择账户</label>
                                    <div class="layui-input-inline" style="width: 200px;">
                                        <select class="layui-select" id="Acount">
                                            <option value="0">全部</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">

                                <div class="layui-inline">
                                    <!--<label class="layui-form-label">开票单位</label>
                                    <div class="layui-input-inline" style="width: 200px;">
                                        <select class="layui-select" id="kpdw">
                                            <option value="0">全部</option>
                                        </select>
                                    </div>-->
                                    <div class="layui-inline">
                                        <input type="checkbox" name="" id="showtype" title="显示明细订单" checked="checked">
                                        <input type="checkbox" name="" id="fhtype" title="包含未发货订单" checked="checked">
                                        <input type="button" id="btn" class="layui-btn" value="查询">
                                    </div>
                                    <div class="layui-inline" style="margin-left:100px">
                                        <input type="button" class="layui-btn layui-btn-mini lab green" color="green" value="单笔订单合计 " />
                                        <input type="button" class="layui-btn layui-btn-mini lab pansy" color="pansy" value="未发货 " />
                                        <input type="button" class="layui-btn layui-btn-mini lab blue" color="blue" value="未发完,无退货 " />
                                        <input type="button" class="layui-btn layui-btn-mini lab brown" color="brown" value="未发完,有退货 " />
                                        <input type="button" class="layui-btn layui-btn-mini lab orange" color="orange" value="已发完,有退货 " />
                                        <input type="button" class="layui-btn layui-btn-mini lab red" color="red" value="无提货清单退货 " />

                                    </div>

                                </div>
                            </div>
                        </div>

                        <table class="layui-table" id="detail" cellpadding="0" cellspacing="0" style="width:80%"></table>
                        <div class="layui-form-item" id="show" style="font-size:16px;margin: 10px auto auto 20px;display:none">
                            <div class="layui-inline ">
                                共计：
                                <span id="num"></span>
                                条
                            </div>
                            <div class="layui-inline ">
                                <label class="layui-form-label"></label>
                                提货金额合计 :
                                <span id="count_buy"></span>
                            </div>
                            <div class="layui-inline ">
                                <label class="layui-form-label"></label>
                                结算金额合计 :
                                <span id="count_pay"></span>
                            </div>
                            <div class="layui-inline ">
                                <label class="layui-form-label"></label>
                                应付余额 :
                                <span id="need_pay"></span>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../js/plugins/layui-1.0.9/layui.js"></script>
    <script type="text/javascript" src="../js/Project/function.js?v=1"></script>

    <script type="text/javascript" language="javascript" src="/js/plugins/table/js/jquery.dataTables.js"></script>
    <script type="text/javascript" language="javascript" src="/js/plugins/table/js/dataTables.bootstrap4.js"></script>
    <script type="text/javascript" language="javascript" src="/js/plugins/table/js/dataTables.buttons.js"></script>
    <script type="text/javascript" language="javascript" src="/js/plugins/table/js/buttons.bootstrap4.js"> </script>
    <script type="text/javascript" src="/js/plugins/table/js/jszip.js"></script>
    <script type="text/javascript" language="javascript" src="/js/plugins/table/js/buttons.html5.js"></script>
    <script type="text/javascript" language="javascript" src="/js/plugins/table/js/buttons.print.js"></script>
    <script type="text/javascript" language="javascript" src="/js/plugins/table/js/buttons.colVis.js"></script>
    <script>

        layui.use(['element', 'util', 'laydate', 'form'], function () {
            //  var $ = layui.jquery,
            var form = layui.form(),
                util = layui.util,
              laydate = layui.laydate,
              element = layui.element(); //Tab的切换功能，切换事件监听等，需要依赖element模块

            var start = {
                min: '2016-01-01 00:00:00'
                 , max: '2099-06-16 23:59:59'
               , format: 'YYYY-MM-DD hh:mm:ss' //日期格式
                , istime: true     //是否开启时间选择
                 , istoday: false
                 , choose: function (datas) {
                     end.min = datas; //开始日选好后，重置结束日的最小日期
                     end.start = datas //将结束日的初始值设定为开始日
                 }
            };

            var end = {
                min: laydate.now()
              , max: '2099-06-16 23:59:59'
                 , format: 'YYYY-MM-DD hh:mm:ss' //日期格式
                , istime: true     //是否开启时间选择
              , istoday: false
              , choose: function (datas) {
                  start.max = datas; //结束日选好后，重置开始日的最大日期
              }
            };

            $("#start_date").click(function () {
                start.elem = this;
                laydate(start);
            });

            $("#end_date").click(function () {
                end.elem = this;
                laydate(end);
            });

            $.ajax({
                url: "../Handler/ProductHandler.ashx",
                type: "Post",
                dataType: "Json",
                data: { "Action": "Get_KPDW" },
                success: function (data) {

                    var html = "";
                    $.each(data.dt, function (i, v) {
                        html += '<option value=' + v.cCusCode + '>' + v.cCusName + '</option>'
                    })
                    $("#kpdw").append(html);
                    html = "";
                    $.each(data.datatable, function (i, v) {
                        html += '<option value=' + v.cCusCode + '>' + v.cCusCode + '</option>'
                    });
                    $("#Acount").append(html);
                    form.render();
                    draw_tb(data.dt);
                }
            })


            $("#btn").click(function () {
                $(".lab").removeClass("grey");
                $.ajax({
                    url: "../Handler/ProductHandler.ashx",
                    type: "Post",
                    dataType: "Json",
                    data: {
                        "Action": "DLproc_OrderExecuteBySel",
                        "timetype": $("#timetype").val(),
                        "strbillno": $("#strbillno").val(),
                        "start_date": $("#start_date").val(),
                        "end_date": $("#end_date").val(),
                        "kpdw": $("#kpdw  option:selected").val(),
                        "showtype": $("#showtype").prop("checked") == false ? "0" : "1",
                        "fhtype": $("#fhtype").prop("checked") == false ? "0" : "1",
                        "Acount":$("#Acount option:selected").val()
                    },
                    success: function (data) {
                        if (data.flag == '0') {
                            layer.alert(data.message, { icon: 2 });
                            return false;
                        }
                        draw_tb(data);


                    }
                })
            })



        })

        function draw_tb(data) {
            var kpdw = $("#kpdw option:selected").text();
            var table = $("#detail").DataTable({
                buttons: ['excel'],
                dom: '<"left"f>r<"right"<"#light"l><"Blight"B>>tip',
                scrollY: "400px",
                pagingType: "full_numbers",//分页样式的类型
                autoWidth: false,
                lengthChange: true,
                ordering: false,
                destroy: true,
                data: data.dt,
                language: {
                    lengthMenu: '每页显示 <select style="height: 35px;width: 100px">' +
                    '<option value="10">10</option>' +
                    '<option value="50">50</option>' +
                    '<option value="100">100</option>' +
                    '<option value="-1">全部</option>' +
                    '</select>条',
                    search: '<span class="label label-success">搜索：</span>',//右上角的搜索文本，可以写html标签

                    paginate: {//分页的样式内容。
                        previous: "上一页",
                        next: "下一页",
                        first: "第一页",
                        last: "最后"
                    },
                    zeroRecords: "没有内容",//table tbody内容为空时，tbody的内容。
                    //下面三者构成了总体的左下角的内容。
                    info: "总共_PAGES_ 页，显示第_START_ 到第 _END_ ，筛选之后得到 _TOTAL_ 条，初始_MAX_ 条 ",//左下角的信息显示，大写的词为关键字。
                    infoEmpty: "0条记录",//筛选为空时左下角的显示。
                    infoFiltered: ""//筛选之后的左下角筛选提示，
                },
                "columns": [
                            { "data": "strBillNo", "title": "DL网单号", class: "center" },
                            { "data": "cSOCode", "title": "正式订单号", class: "center" },
                            {
                                "data": "datBillTime", "title": "下单时间", class: "center",
                                render: function (data, type, row, meta) {
                                    if (data != "" && data != null) {
                                        return return_datetime(data);
                                    } else {
                                        return "";
                                    }

                                }
                            },
                            {
                                "data": "datAuditordTime", "title": "审核时间", class: "center",
                                render: function (data, type, row, meta) {
                                    if (data != "" && data != null) {
                                        return return_datetime(data);
                                    } else {
                                        return "";
                                    }

                                }
                            },
                            { "data": "ccusname", "title": "开票单位", class: "center" },
                            { "data": "cinvname", "title": "商品名称", class: "center" },
                            { "data": "cInvStd", "title": "商品规格", class: "center" },
                            { "data": "iquantity", "title": "订单数量", class: "center" },
                            { "data": "isum", "title": "订单金额", class: "center" },
                            { "data": "U8iFHQuantity", "title": "发货数量", class: "center" },
                            { "data": "U8iFHMoney", "title": "发货金额", class: "center" },
                            { "data": "U8iTHQuantity", "title": "退货数量", class: "center" },
                            { "data": "U8iTHMoney", "title": "退货金额", class: "center" },
                            { "data": "BillStatus", "title": "状态", class: "center" },
                            {
                                "data": "cdefine11", "title": "地址信息", class: "center", width: 130,
                                render: function (data, type, row, meta) {
                                    if (data != null) {
                                        if (data.length > 15) {
                                            return '<span title=' + data + '>' + data.substring(0, 10) + ' ......</span>';
                                        } else {
                                            return data;
                                        }
                                    }
                                    else {
                                        return '';
                                    }
                                }
                            },
                            {
                                "data": "strRemarks", "title": "备注", class: "center", width: 130,
                                render: function (data, type, row, meta) {
                                    if (data != null) {
                                        if (data.length > 15) {
                                            return '<span title=' + data + '>' + data.substring(0, 10) + ' ......</span>';
                                        } else {
                                            return data;
                                        }
                                    }
                                    else {
                                        return '';
                                    }
                                }
                            }, { "data": "strAllAcount", "title": "下单账号", class: "center" },

                ],
                createdRow: function (row, data, index) {
                    if (data.cinvname == "合计") {
                        $(row).addClass("green");
                    } else {
                        var color = "";
                        switch (data.BillStatus) {
                            case "未发货":
                                color = "pansy";
                                break;
                            case "未发完,无退货":
                                color = "blue";
                                break;
                            case "未发完,有退货":
                                color = "brown";
                                break;
                            case "已发完,有退货":
                                color = "orange";
                                break;
                            case "无提货清单退货":
                                color = "red";
                                break;
                        }
                        $(row).addClass(color);
                    }
                }
            });
            $(".buttons-excel").find("span").text("导出Excel");
        }



        function set_color(tableid) {

        }

        $("#btn1").click(function () {
            var table = $("#detail").DataTable({

            });
            var data = table.rows().data();
            $.each(data, function (i, v) {
                console.log(v);
            })
        })

        $(".lab").click(function () {
            var $this = $(this);
            var $trs = $("#detail tbody tr");
            var val = $this.attr("value").trim();
            var table = $("#detail").DataTable();

            

            if (val == '单笔订单合计') {
                val = '合计';
                if ($this.hasClass("grey")) {
                    table.column(5).search("").column(13).search("").draw();
                    $(".lab").removeClass("grey");
                } else {

                    console.log(val)
                    table.column(5).search(val).column(13).search("").draw();
                    $(".lab").removeClass("grey");
                    $this.addClass("grey");
                }
            } else {
                if ($this.hasClass("grey")) {
                    table.column(5).search("").column(13).search("").draw();
                    $(".lab").removeClass("grey");
                } else {

                    console.log(val)
                    table.column(5).search("").column(13).search(val).draw();
                    $(".lab").removeClass("grey");
                    $this.addClass("grey");
                }
             
            }
           
        })
    </script>

</body>
</html>